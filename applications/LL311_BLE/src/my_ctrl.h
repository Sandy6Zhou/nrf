/********************************************************************
**版权所有         深圳市几米物联有限公司
**文件名称:        my_ctrl.h
**文件描述:        系统控制模块头文件 (LED, Buzzer, Key)
**当前版本:        V1.0
**作    者:        Harrison Wu (wuyujiao@jimiiot.com)
**完成日期:        2026.01.15
*********************************************************************
** 功能描述:        1. 整合 LED 指示灯控制
**                 2. 整合蜂鸣器 PWM 驱动
**                 3. 实现 FUN_KEY (P1.09) 按键检测
**                 4. 提供独立线程处理控制任务
*********************************************************************/

#ifndef _MY_CTRL_H_
#define _MY_CTRL_H_

#include <zephyr/types.h>

/* --- 蜂鸣器相关定义 --- */
struct my_buzzer_note
{
    uint32_t freq_hz;     /* 频率 (Hz) */
    uint32_t duration_ms; /* 持续时间 (ms) */
};

/* --- 控制消息定义 --- */
enum my_ctrl_msg_type
{
    MY_CTRL_MSG_TYPE_LED,    /* LED 控制消息 */
    MY_CTRL_MSG_TYPE_BUZZER, /* 蜂鸣器控制消息 */
};

struct my_ctrl_msg
{
    enum my_ctrl_msg_type type;
    union
    {
        struct
        {
            uint32_t led_idx;
            uint32_t val;
        } led;
        struct
        {
            uint32_t freq_hz;
            uint32_t duration_ms;
        } buzzer;
    } data;
};

/* --- 接口函数 --- */

/********************************************************************
**函数名称:  my_ctrl_init
**入口参数:  tid      ---        指向线程 ID 变量的指针
**出口参数:  tid      ---        存储启动后的线程 ID
**函数功能:  初始化控制模块 (GPIO, PWM) 并启动控制线程
**返 回 值:  0 表示成功，负值表示失败
*********************************************************************/
int my_ctrl_init(k_tid_t *tid);

/********************************************************************
**函数名称:  my_ctrl_buzzer_play_tone
**入口参数:  freq_hz      ---        频率 (Hz)
**           duration_ms  ---        持续时间 (ms)
**出口参数:  无
**函数功能:  播放一个指定频率和时长的单音
**返 回 值:  0 表示成功
*********************************************************************/
int my_ctrl_buzzer_play_tone(uint32_t freq_hz, uint32_t duration_ms);

/********************************************************************
**函数名称:  my_ctrl_buzzer_play_sequence
**入口参数:  notes        ---        音符数组指针
**           num_notes    ---        音符数量
**出口参数:  无
**函数功能:  播放一组音符序列
**返 回 值:  0 表示成功
*********************************************************************/
int my_ctrl_buzzer_play_sequence(const struct my_buzzer_note *notes, uint32_t num_notes);

/********************************************************************
**函数名称:  my_ctrl_led_set
**入口参数:  led_idx      ---        LED 索引 (对应 DK_LED1, DK_LED2 等)
**           val          ---        1 亮，0 灭
**出口参数:  无
**函数功能:  设置 LED 状态
**返 回 值:  无
*********************************************************************/
void my_ctrl_led_set(uint32_t led_idx, uint32_t val);

/********************************************************************
**函数名称:  my_ctrl_push_msg
**入口参数:  msg        ---        消息结构体指针
**出口参数:  无
**函数功能:  向控制模块消息队列发送消息
**返 回 值:  0 表示成功，负值表示失败
*********************************************************************/
int my_ctrl_push_msg(const struct my_ctrl_msg *msg);

#endif /* _MY_CTRL_H_ */
